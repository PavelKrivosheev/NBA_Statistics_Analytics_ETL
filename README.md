# ETL-–ø–∞–π–ø–ª–∞–π–Ω NBA Stats üèÄ

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ **ETL-–ø–∞–π–ø–ª–∞–π–Ω NBA Stats**! –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Å–±–æ—Ä, –æ–±—Ä–∞–±–æ—Ç–∫—É –∏ –∞–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ NBA, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞—à–±–æ—Ä–¥—ã –≤ Metabase. –û—Ç —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–æ –∫—Ä—É—Ç—ã—Ö –∏–Ω—Å–∞–π—Ç–æ–≤ ‚Äî –¥–∞–≤–∞–π –Ω–∞—á–Ω—ë–º! üöÄ

## üìù –û –ø—Ä–æ–µ–∫—Ç–µ
–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞—ë—Ç ETL-–ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö NBA –∏–∑ SQLite –∏ CSV, –∏—Ö —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ PostgreSQL DWH –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ Metabase. –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- **–î–∞–Ω–Ω—ã–µ**: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä, –±—Ä–æ—Å–∫–æ–≤, –∏–≥—Ä–æ–∫–æ–≤ –∏ –∫–æ–º–∞–Ω–¥ (2010‚Äì2023).
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**: Python, Airflow, PostgreSQL, Metabase, Docker.
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –î–∞—à–±–æ—Ä–¥—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –±—Ä–æ—Å–∫–æ–≤, –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥–æ–≤ —Ç—Ä—ë—Ö–æ—á–∫–æ–≤—ã—Ö.

## üõ† –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker –∏ Docker Compose
- Python 3.8+
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—Å–º. `requirements.txt`):
  ```
  faker
  psycopg2-binary
  SQLAlchemy-Utils<0.38.0
  tenacity>=8.0.0
  ```

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**:
   ```bash
   git clone <repository_url>
   cd nba_stats_pipeline
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Docker**:
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Docker –∑–∞–ø—É—â–µ–Ω.
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `docker-compose.yml` (–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω —Ä–∞–Ω–µ–µ) –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞.
   - –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö:
     - SQLite: `/opt/airflow/data/nba.sqlite`
     - CSV: `/opt/airflow/data/csv/NBA_{year}_Shots.csv`

3. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python**:
   ```bash
   pip install -r requirements.txt
   ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ Docker Compose**:
   ```bash
   docker-compose up -d
   ```
   - Airflow: `http://localhost:8080` (–ª–æ–≥–∏–Ω: `admin`, –ø–∞—Ä–æ–ª—å: `admin`)
   - Metabase: `http://localhost:3000`
   - PostgreSQL: `host=postgres_db1`, `port=5432`, `user=admin`, `password=admin`

5. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ Airflow**:
   - –û—Ç–∫—Ä–æ–π—Ç–µ Airflow UI.
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ `dag_load_static.py` –≤—Ä—É—á–Ω—É—é, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å ETL.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
nba_stats_pipeline/
‚îú‚îÄ‚îÄ dags/
‚îÇ   ‚îú‚îÄ‚îÄ dag_load_static.py
‚îÇ   ‚îú‚îÄ‚îÄ dag_load_incremental_game.py
‚îÇ   ‚îú‚îÄ‚îÄ dag_load_incremental_line_score_game.py
‚îÇ   ‚îú‚îÄ‚îÄ dag_load_incremental_shot_data.py
‚îÇ   ‚îú‚îÄ‚îÄ dag_load_dds.py
‚îÇ   ‚îú‚îÄ‚îÄ dag_data_marts.py
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ load_static_tables.py
‚îÇ   ‚îú‚îÄ‚îÄ load_incremental_game.py
‚îÇ   ‚îú‚îÄ‚îÄ load_incremental_line_score_game.py
‚îÇ   ‚îú‚îÄ‚îÄ load_incremental_shot_data.py
‚îÇ   ‚îú‚îÄ‚îÄ load_dds_tables.py
‚îÇ   ‚îú‚îÄ‚îÄ load_data_marts.py
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ nba.sqlite
‚îÇ   ‚îú‚îÄ‚îÄ csv/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NBA_2010_Shots.csv
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ logs/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ README.md
```

## üèÄ –ó–∞–ø—É—Å–∫ –ø–∞–π–ø–ª–∞–π–Ω–∞
1. –û—Ç–∫—Ä–æ–π—Ç–µ Airflow UI (`http://localhost:8080`).
2. –í–∫–ª—é—á–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `dag_load_static.py` –≤—Ä—É—á–Ω—É—é.
3. –ü–∞–π–ø–ª–∞–π–Ω –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç DAGs:
   - –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã ‚Üí –ò–≥—Ä—ã ‚Üí –°—á—ë—Ç –ø–æ —á–µ—Ç–≤–µ—Ä—Ç—è–º ‚Üí –ë—Ä–æ—Å–∫–∏ ‚Üí DDS ‚Üí –í–∏—Ç—Ä–∏–Ω—ã.
4. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –≤ `/opt/airflow/logs` –∏–ª–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `tech.load_logs` –≤ PostgreSQL.

## üìä –î–æ—Å—Ç—É–ø –∫ –¥–∞—à–±–æ—Ä–¥–∞–º
- –û—Ç–∫—Ä–æ–π—Ç–µ Metabase: `http://localhost:3000/dashboard/2-nba-demo`
- –ò—Å—Å–ª–µ–¥—É–π—Ç–µ –¥–∞—à–±–æ—Ä–¥—ã:
  - üèÄ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –±—Ä–æ—Å–∫–æ–≤ –∏–≥—Ä–æ–∫–æ–≤**: –¢–æ—á–Ω–æ—Å—Ç—å –ø–æ –∑–æ–Ω–∞–º –∏ –∏–≥—Ä–æ–∫–∞–º.
  - üèÄ **–†–µ–∑—É–ª—å—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥**: –û—á–∫–∏, –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π, –æ—á–∫–∏ –≤ –∫—Ä–∞—Å–∫–µ.
  - üèÄ **–¢—Ä–µ–Ω–¥—ã —Ç—Ä—ë—Ö–æ—á–∫–æ–≤—ã—Ö**: –ü–æ–ø—ã—Ç–∫–∏, —Ç–æ—á–Ω–æ—Å—Ç—å, –≤–∫–ª–∞–¥ –≤ —Å—á—ë—Ç.

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –±—Ä–æ—Å–∫–æ–≤**: –°—Ä–∞–≤–Ω–∏—Ç–µ —Ç–æ—á–Ω–æ—Å—Ç—å –õ–µ–±—Ä–æ–Ω–∞ –Ω–∞ —Å—Ä–µ–¥–Ω–µ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –∏ –ö–∞—Ä—Ä–∏ —Å —Ç—Ä—ë—Ö–æ—á–∫–æ–≤–æ–π.
- **–†–µ–∑—É–ª—å—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥**: –£–∑–Ω–∞–π—Ç–µ, –∫—Ç–æ –¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç –≤ –∫—Ä–∞—Å–∫–µ.
- **–¢—Ä–µ–Ω–¥—ã —Ç—Ä—ë—Ö–æ—á–∫–æ–≤—ã—Ö**: –û—Ç—Å–ª–µ–¥–∏—Ç–µ —Ä–æ—Å—Ç –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ —Ç—Ä—ë—Ö–æ—á–∫–æ–≤—ã—Ö –ø–æ —Å–µ–∑–æ–Ω–∞–º.

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫
- **–û—à–∏–±–∫–∏ Airflow**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `/opt/airflow/logs`.
- **–ü—Ä–æ–±–ª–µ–º—ã —Å –¥–∞–Ω–Ω—ã–º–∏**: –ò–∑—É—á–∏—Ç–µ `tech.load_logs` –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —Å–±–æ–µ–≤.
- **Metabase**: –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL (`host=postgres_db1`, `port=5432`).

## üåü –ö–∞–∫ –≤–Ω–µ—Å—Ç–∏ –≤–∫–ª–∞–¥
–•–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏–ª–∏ –¥–∞—à–±–æ—Ä–¥—ã? –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, —Å–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ PR! üèÄ
